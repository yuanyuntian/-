## 寄存器(内存访问)

上面几章主要是从逻辑结构，形成物理的方法，以及相关寄存器等一些指令去讲解8086CPU的逻辑结构。下面从内存访问角度继续学习

### 内存中字的存储

CPU中，用16位寄存器来存储一个字，高8位存放高位字节，低8位存放低位字节。在内存中存储时，由于内存单元是字节单元（一个单元存放一个字节），则一个字要用两个地址连续的内存单元来存放，在这个字的低位字节存放在地地址单元中，高位字节存放在高地址单元中。

### DS和[address]
CPU必须先得到内存单元的地址才能进行读写，在8086CPU中有一个DS寄存器，通常用来存放要访问的数据的段地址。8086CPU不支持将数据直接送入段寄存器的操作，DS是一个段寄存器。如果要修改，可以在用一个寄存器来进行中转，即先将1000H送入一个一般的寄存器。

### 字的传送

前面我们用mov指令在寄存器和内存之间进行字节型数据的传送。因为8086CPU是一个16位结构，有16根数据线，所以可以一次性传送16位数据，也就是说可以一次性传送一个字。

### 数据段
在编程时，可以根据需要，将一组内存单元定义为一个段，我们可以将一组长度为N(N<= 64KB)，地址连续，起始地址为16的倍数的内存单元当做专门存储数据的内存空间，从而定义了一个数据段。如何访问数据段中的数据呢？将一段内存当作数据段，使我们编程时的一种安排，可以在具体操作的时候，用ds存放数据段的段地址，再根据需要，用相关指令访问数据段中的具体单元。

### 栈

栈是一种具有特殊的访问方式的存储空间，最后进入这个空间的数据，最先出去
栈有两个基本的操作：入栈和出栈。入栈就是将一个新的元素放到栈顶，出栈就是从栈顶取出一个元素。栈顶的元素总是最后入栈，需要出栈时，又最先被从栈中取出 LIFO

### CPU提供的栈机制

8086CPU提供相关指令来以栈的方式访问内存空间。这就意味着，在基于8086CPU编程的时候，可以将一段内存当做栈来使用。8086CPU提供入栈和出栈的指令，最基本的两个是PUSH（入栈）和POP（出栈）。比如 push ax表示将寄存器ax中的数据送入栈中，pop ax表示从栈顶取出数据送入ax。8086CPU的入栈和出栈操作都是以字为单位进行的。
cpu如何知道当前要执行的指令所在位置？我们现在知道答案，那就是CS,IP中存放着当前指令的段地址和偏移地址。那么CPU是如何知道栈顶位置的？显然，也应该有相应的寄存器来存放栈顶的位置，在8086CPU中，有另个寄存器，段寄存器SS和寄存器SP，栈顶的段地址存放在SS中，偏移地址存在放SP中。任意时刻，SS:SP指向栈顶元素。push指令和pop指令执行时，CPU从SS和SP中得到栈顶的地址。
现在，我们可以完整描述push和pop指令功能，例如 push ax

- SP=SP -2,SS：SP指向当前栈顶前面的单元，以当前栈顶前面的单元为新的栈顶
- 将ax中的内容送入ss:sp指向的内存单元处，SS:SP此时指向新栈顶

入栈时，栈顶从高地址像低地址方向增长

### 栈段
将一段内存作为栈段，仅仅是我们在编程时的一种安排，CPU并不会由于这种安排，就在执行push,pop等栈操作指令时自动将我们定义的栈段当作栈空间来访问。